
<!doctype html>
<html>

	<head>
		<style>
			.flex_div_row {
				display:flex;
				flex-direction:row;
				justify-content:space-between
			}


		</style>

		<title>Corona Visrus Cases</title>
		<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.lazy/1.7.10/jquery.lazy.min.js"></script>
		<script type="text/javascript"> $(function() {
        $('.lazy').lazy();
    });
</script>
		<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

		<script src="utils.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

	</head>

	<body>
		<p> 
			hello
		</p>
 
		<div id="container" class = "flex_div_row" style=" width: 100%;">
			<div id="chartContainer"  style="text-align:center; width: 50%;display: block">  hi <br /> </div> 
			<div id="chernoffContainer"  style="text-align:center; width: 50%;display: block"> Happiness World Report 2019 <br /></div> 
		</div> 

	
		 <script>



			let data;
			axios.get('https://pomber.github.io/covid19/timeseries.json') // one time, will never leave this point without finish or fail.
				  .then(function (response) {
			    // handle success
				data = response.data;
			 	for(i =0 ; i <75 ; i++)
				var config = [];
				var numberOfCases = 0;
				var dayIndex = data['US'].length-1;

				Object.keys(data).forEach(function(key){
						numberOfCases = numberOfCases + data[key][dayIndex].confirmed;
				});
				
				var countries = [];
				var k =0 ;
				
				Object.keys(data).forEach(function(key){
				
					countries[k] = {name:key, confirmed:data[key][dayIndex].confirmed}
					k++;
					
				});
				countries.sort(function(a,b) {
					return b.confirmed - a.confirmed
				});
				
				let map = new Map() ;
				var countriesNames = [];

				for(i = 0; i < k; i++){
					map.set(countries[i].name, i);
					countriesNames[i] = countries[i].name;
				}

				// console.log(map)
				
				Object.keys(data).forEach(function(key){
				
				
					c = data[key][dayIndex].confirmed;
					d = data[key][dayIndex].deaths;
					r = data[key][dayIndex].recovered;

					config[map.get(key)] = {
						type: 'pie',
						data: {
								datasets: [{
									data: [
										  (c - d - r),
										 d,
										 r,
										 (numberOfCases - c),
									],
									backgroundColor: [
										"#00ccff",
										"#e60000",
										"#00cc00",
										"#e0ebeb",
									],
									label: 'Dataset 1'
								}],
								labels: [
									key + ' - Active Cases '+ ( c - d - r )  ,
									key + ' - Deaths ' +  d ,
									key + ' - Recovered Cases ' + r,
									'Other Countries - All Cases ' + (numberOfCases - c)
								]
								},
						options: {
							responsive: true
						}
					};
				});
 
				document.getElementById('chartContainer').innerText = data['US'][dayIndex].date ;
   

				for( let counter=0 ; counter<k ; counter++) {
					var canvas = document.createElement('canvas');
					canvas.id = counter;
					canvas.className = counter;
					document.getElementById('chartContainer').appendChild(canvas);
					
					var canvas2 = document.createElement('img');
					canvas2.id = counter + k;
					canvas2.className = counter + k;
					// canvas2.style="width:100%";
					
					document.getElementById('chernoffContainer').appendChild(canvas2);
				}

				var counter = 0,
			    interval;

				var drawCanvas = function () {
					var ctx = document.getElementById(counter).getContext('2d');
					ctx.width = "100px";
					ctx.height = "100px";

					window.myPie = new Chart(ctx, config[counter]);
					
					var canvas = document.getElementById(counter );
						
					
					var img = document.getElementById(counter + k );
	  				img.height = canvas.height ;
	  				img.width = canvas.width*(0.50) ;

	  				img.style.height = canvas.style.height ;
	  				img.style.width = canvas.style.width*(0.50)  ;
	  				img.class = "lazy" ;
					img.src = countriesNames[counter]+'.jpg';

				};

				interval = window.setInterval(function () {

				    if (counter < k) {
				        drawCanvas();
				        counter += 1;
				    } else {
				        window.clearInterval(interval);
				        
				    }

				}, 25);
			})
			.catch(function (error) {
			// handle error, alert something for the user
			console.log(error);
			})
			.then(function () {
			// always executed, could be anything

			});

		</script>

	</body>

</html>
